<!--------------- Añadir header aquí ------------>
<app-header />

<!-- Toast para mensaje de preguntas guardadas -->
<div
  *ngIf="showSavedToast"
  class="fixed top-4 right-4 px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 z-50"
  [ngClass]="{
    'bg-primaryColor text-white': toastType === 'success',
    'bg-red-100 text-red-800': toastType === 'error'
  }"
>
  <i class="fa-solid"
    [ngClass]="{
      'fa-check-circle': toastType === 'success',
      'fa-circle-xmark': toastType === 'error'
    }"
  ></i>
  <span>{{ toastMessage }}</span>
</div>


<!--------------- Añadir barra de progreso aquí ------------>
<div class="flex justify-center">
  <div class="progress-bar-container">
    <div class="progress-bar" [style.width.%]="progress()">
      {{ progressText() }}
    </div>
  </div>
</div>

<!--------------- Añadir preguntas del test aquí ------------>
<div class="flex justify-center p-4">
  <div class="w-full max-w-3xl">
    <div *ngFor=" let question of examQuestion.slice(
          page.first,
          page.first + questionsPerPage
        );
        let i = index
      "
      class="p-6 mb-12 border rounded-xl bg-gray-50 relative"
    >
      <h2
        class="text-lg font-semibold mb-2"
        [innerHTML]="
          page.page * questionsPerPage + i + 1 + '.' + question.title
        ">
      </h2>
      
      <hr class="border-t border-gray-300 mb-4" />
    
      <i class="fa-solid fa-triangle-exclamation absolute top-1 right-2 cursor-pointer text-xl
         text-primaryColor hover:text-yellow-600 transition"
        (click)="openModal(question.id)"
        title="Reportar pregunta">
      </i>
      
      <ul class="list-none space-y-2">
        <li *ngFor="let respuesta of question.respuestas">
          @if (respuesta !="") {
          <label class="space-x-3">
            <input
              type="radio"
              name="question-{{ page.page * questionsPerPage + i }}"
              class="form-radio h-4 w-4 text-yellow-500 border-gray-300 focus:ring-yellow-400"
              [(ngModel)]="
                userResponses[page.page * questionsPerPage + i].optionSelected
              "
              [value]="respuesta"
              (change)="
                onSelectAnswer(page.page * questionsPerPage + i, respuesta)
              "
            />
            <span class="text-gray-700">{{ respuesta }}</span>
          </label>
          }
        </li>
      </ul>

      <i class="fa-regular fa-floppy-disk absolute bottom-1 right-2 cursor-pointer text-xl"
        [ngClass]="{
          'text-gray-400': !isQuestionSaved(question.id),
          'text-primaryColor': isQuestionSaved(question.id)
        }"
        (click)="questionSaved(question.id)"
        [title]="isQuestionSaved(question.id) ? 'Quitar pregunta guardada' : 'Guardar pregunta'">
      </i>
    </div>

    <!-------------------- Modal de reporte ----------------->
    <div
      id="reportModal"
      class="modal hidden fixed top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-50"
    >
      <div class="bg-white p-8 rounded-lg">
        <h2 class="text-xl mb-4 font-bold">
          Indique el motivo de reportar esta pregunta. Si necesitas respuesta, indica tu correo electrónico en el reporte.
        </h2>
        <textarea
          id="reportReason"
          class="w-full p-2 border border-gray-300 rounded-lg mb-4"
          rows="4"
          placeholder="Motivo del reporte"
        ></textarea>
        <div class="flex justify-center mt-8">
          <button
            class="text-gray-900 hover:bg-gray-300 border border-primaryColor focus:outline-none font-medium rounded-lg px-2 py-2 mr-8"
            (click)="closeModal()"
          >
            Cancelar
          </button>
          <button
            class="text-white bg-primaryColor hover:bg-yellow-600 border border-primaryColor focus:outline-none font-medium rounded-lg px-4 py-2"
            (click)="sendReport()"
          >
            Enviar
          </button>
        </div>
      </div>
    </div>

    <!-------------------- Paginación ---------------->

    <div
      class="pagination-container relative flex justify-center mt-6 space-x-2"
    >
      <p-paginator
        (onPageChange)="onPageChange($event)"
        [first]="0"
        [rows]="questionsPerPage"
        [totalRecords]="examQuestion.length"
      />

      @if (progress() == 100) {
      <button
        class="finish-button text-white bg-primaryColor hover:bg-yellow-600 border border-primaryColor focus:outline-none font-medium rounded-lg px-5 py-2.5"
        (click)="openModalTest()"
      >
        Terminar
      </button>
      }
    </div>

    <!-------------------- Modal de fin de test ----------------->
    <div
      id="finishTest"
      class="modal hidden fixed top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-50"
    >
      <div class="bg-white p-8 rounded-lg">
        <h2 class="text-xl mb-4 font-bold">
          ¿Estás seguro que quieres enviar el examen?
        </h2>
        <div class="flex justify-center">
          <button
            class="text-gray-900 hover:bg-gray-300 border border-primaryColor focus:outline-none font-medium rounded-lg px-2 py-2 mr-8"
            (click)="closeModalTest()"
          >
            Cancelar
          </button>
          <button
            class="text-white bg-primaryColor hover:bg-yellow-600 border border-primaryColor focus:outline-none font-medium rounded-lg px-4 py-2"
            (click)="sendTest()"
          >
            Enviar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
